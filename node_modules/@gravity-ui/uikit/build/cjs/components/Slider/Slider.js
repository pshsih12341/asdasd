"use strict";
'use client';
Object.defineProperty(exports, "__esModule", { value: true });
exports.Slider = void 0;
const tslib_1 = require("tslib");
const react_1 = tslib_1.__importDefault(require("react"));
const debounce_1 = tslib_1.__importDefault(require("lodash/debounce"));
const theme_1 = require("../theme");
const cn_1 = require("../utils/cn");
const BaseSlider_1 = require("./BaseSlider/BaseSlider");
const HandleWithTooltip_1 = require("./HandleWithTooltip/HandleWithTooltip");
const utils_1 = require("./utils");
require("./Slider.css");
const b = (0, cn_1.block)('slider');
exports.Slider = react_1.default.forwardRef(function Slider({ value, defaultValue = 0, size = 'm', min = 0, max = 100, step = 1, marksCount = 2, availableValues, hasTooltip, markFormat, marks, tooltipDisplay, tooltipFormat = markFormat, errorMessage, validationState, disabled = false, debounceDelay = 0, onBlur, onUpdate, onUpdateComplete, onFocus, autoFocus = false, tabIndex, className, qa, apiRef, 'aria-label': ariaLabelForHandle, 'aria-labelledby': ariaLabelledByForHandle, }, ref) {
    const direction = (0, theme_1.useDirection)();
    // eslint-disable-next-line react-hooks/exhaustive-deps
    const handleUpdate = react_1.default.useCallback((0, debounce_1.default)((changedValue) => onUpdate === null || onUpdate === void 0 ? void 0 : onUpdate(changedValue), debounceDelay), [onUpdate, debounceDelay]);
    // eslint-disable-next-line react-hooks/exhaustive-deps
    const handleUpdateComplete = react_1.default.useCallback((0, debounce_1.default)((changedValue) => onUpdateComplete === null || onUpdateComplete === void 0 ? void 0 : onUpdateComplete(changedValue), debounceDelay), [onUpdateComplete, debounceDelay]);
    react_1.default.useEffect(() => {
        return () => {
            handleUpdate.cancel();
            handleUpdateComplete.cancel();
        };
    }, [handleUpdate, handleUpdateComplete]);
    const innerState = (0, utils_1.prepareSliderInnerState)({
        availableValues,
        defaultValue,
        marksCount,
        max,
        min,
        step,
        value,
        markFormat,
        marks,
        hasTooltip,
        tooltipDisplay,
        tooltipFormat,
    });
    const stateModifiers = react_1.default.useMemo(() => ({
        size,
        error: validationState === 'invalid' && !disabled,
        disabled,
        'tooltip-display': innerState.tooltipDisplay,
        rtl: direction === 'rtl',
        'no-marks': Array.isArray(marks) ? marks.length === 0 : marks === 0,
    }), [direction, disabled, innerState.tooltipDisplay, size, validationState, marks]);
    const handleRender = react_1.default.useMemo(() => innerState.tooltipDisplay === 'off'
        ? undefined
        : (originHandle, originHandleProps) => (react_1.default.createElement(HandleWithTooltip_1.HandleWithTooltip, { originHandle: originHandle, originHandleProps: originHandleProps, stateModifiers: stateModifiers, className: b('tooltip'), tooltipFormat: innerState.tooltipFormat })), [innerState.tooltipDisplay, innerState.tooltipFormat, stateModifiers]);
    return (react_1.default.createElement("div", { className: b(null, className), ref: ref },
        react_1.default.createElement("div", { className: b('top', { size, 'tooltip-display': tooltipDisplay }) }),
        react_1.default.createElement(BaseSlider_1.BaseSlider, { ref: apiRef, value: innerState.value, defaultValue: innerState.defaultValue, min: innerState.min, max: innerState.max, step: innerState.step, range: innerState.range, disabled: disabled, marks: innerState.marks, onBlur: onBlur, onFocus: onFocus, onChange: handleUpdate, onChangeComplete: handleUpdateComplete, stateModifiers: stateModifiers, 
            // eslint-disable-next-line jsx-a11y/no-autofocus
            autoFocus: autoFocus, tabIndex: tabIndex, "data-qa": qa, handleRender: handleRender, reverse: stateModifiers.rtl, ariaLabelForHandle: ariaLabelForHandle, ariaLabelledByForHandle: ariaLabelledByForHandle }),
        stateModifiers.error && errorMessage && (react_1.default.createElement("div", { className: b('error', { size }) }, errorMessage))));
});
