"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useSelect = void 0;
const tslib_1 = require("tslib");
const react_1 = tslib_1.__importDefault(require("react"));
const useControlledState_1 = require("../useControlledState");
const useOpenState_1 = require("./useOpenState");
const useSelect = ({ defaultOpen, onClose, onOpenChange, open, value: valueProps, defaultValue = [], multiple, onUpdate, disabled, }) => {
    const [value, setValueInner] = (0, useControlledState_1.useControlledState)(valueProps, defaultValue, onUpdate);
    const [activeIndex, setActiveIndex] = react_1.default.useState();
    const _a = (0, useOpenState_1.useOpenState)({
        defaultOpen,
        onClose,
        onOpenChange,
        open,
    }), { toggleOpen } = _a, openState = tslib_1.__rest(_a, ["toggleOpen"]);
    const setValue = react_1.default.useCallback((v) => {
        if (!disabled) {
            setValueInner(v);
        }
    }, [setValueInner, disabled]);
    const handleSingleSelection = react_1.default.useCallback((option) => {
        if (!value.includes(option.value)) {
            const nextValue = [option.value];
            setValue(nextValue);
        }
        toggleOpen(false);
    }, [value, setValue, toggleOpen]);
    const handleMultipleSelection = react_1.default.useCallback((option) => {
        const alreadySelected = value.includes(option.value);
        const nextValue = alreadySelected
            ? value.filter((iteratedVal) => iteratedVal !== option.value)
            : [...value, option.value];
        setValue(nextValue);
    }, [value, setValue]);
    const handleSelection = react_1.default.useCallback((option) => {
        if (multiple) {
            handleMultipleSelection(option);
        }
        else {
            handleSingleSelection(option);
        }
    }, [multiple, handleSingleSelection, handleMultipleSelection]);
    const handleClearValue = react_1.default.useCallback(() => {
        setValue([]);
    }, [setValue]);
    return Object.assign({ value,
        activeIndex,
        setValue,
        handleSelection,
        handleClearValue,
        toggleOpen,
        setActiveIndex }, openState);
};
exports.useSelect = useSelect;
